# !/bin/bash
# AUTHOR: 0hm clout [at] freegeek.org
# NOTES: one must have cdrecord working fully for this script, because 
# it is more, or less a wrapper for that util as well as md5sum
# REASON: this script is to automate the way we test cdrw drives so even less
# knowledge is need to do so ^_^
# TODO: Make it so this script uses two vars one for the ISO image, which it already does, and
# another one to override the for loop and just give it a /dev/real_device (/dev/hdc, /dev/sda1, etc...)
# example of future optional syntax: whateverthenameofthisscriptis /dev/hdc image.iso  

IMAGE=null

if [ ! -n "$1" ]; then
    echo "Usage: test.sh filename"
    exit
fi

if [ -e "$1" ]; then
    IMAGE=$1
    export IMAGE
else
    echo "$1 is not a file!"
    exit
fi

echo $IMAGE is the image that I will burn press ^c to stop ( Ctrl+c )

DEVICE=null

for REPLY in $(cdrecord -scanbus 2>/dev/null \
    | egrep ' *[0-9]+,[0-9]+,[0-9]+' | grep -v "*" \
    | awk '{print $1}'); do
    if cdrecord -checkdrive dev=$REPLY 2>/dev/null \
	| egrep -q 'Device seems to be:.*CD-RW'; then
	DEVICE=$REPLY
	export DEVICE
    fi
done
echo " I will now burn the ISO please press enter"
read
echo
echo cdrecord dev=$DEVICE $IMAGE
if [ "$?" != 0 ]; then
    echo "cdrecord failed with an error: $?"               # probably add a fuction to find the real device
elif                                                      # here and replace the one of the $IMAGE vars down 
    echo " I will now test the $IMAGE file press enter"  ######## below with the real device var
    read                                                  #
    diff <(md5sum $IMAGE) <(md5sum $IMAGE); then           #
    if [ "$?" = 0 ]; then
	echo "passed md5 test"
    else
	echo "failed md5 test"
    fi
fi
# askgl;ajk;asdf;akjsdfaslkjfhlkasdf ass